# Отчёт: Модель Next Best Offer (NBO)

## Задача

Построить систему персонализированных рекомендаций продуктов для клиентов МТС Линк без использования прогноза LTV.

**Бизнес-цель:** Повысить конверсию и выручку за счёт предложения клиенту наиболее релевантного продукта в нужный момент.


## Подход

Вместо прогнозирования LTV (который показал плохие результаты) мы решили задачу как **классификацию**: предсказать, какой продукт клиент купит следующим.

### Данные
- 14,702 транзакции от 2,121 компании (всего в базе)
- 1,681 компания с достаточной историей для рекомендаций
- 26 уникальных продуктов в каталоге
- Период: 2014–2023 гг.

### Признаки
- **История покупок:** предыдущий продукт, тип сделки, дней с прошлой покупки
- **RFM-метрики:** частота, сумма покупок, давность, возраст клиента
- **Поведение:** количество возвратов, новых покупок, продлений, расширений
- **Данные компании:** сектор, сегмент, размер

### Модель
LightGBM (градиентный бустинг) с multi-class классификацией.


## Результаты

### Качество модели

| Метрика | Значение | Комментарий |
|---------|----------|-------------|
| **Top-1 Accuracy** | 64.3% | В 64% случаев угадываем точный продукт |
| **Top-3 Accuracy** | 90.7% | В 91% случаев верный продукт в топ-3 |
| **MAP@3** | 0.767 | Качество ранжирования |

### Сравнение с baseline

| Baseline | Top-3 Accuracy | Lift |
|----------|----------------|------|
| Случайный выбор | 11.5% | — |
| **Наша модель** | **90.7%** | **7.9x** |

Модель в **7.9 раз лучше** случайных рекомендаций.

### Качество по сегментам

| Сегмент | Top-3 Accuracy |
|---------|----------------|
| High-value клиенты (топ 25%) | **94.1%** |
| Остальные клиенты | 89.6% |

Для ценных клиентов модель работает ещё лучше.


## Что получили на выходе

Для каждой из **1,681 компании** с достаточной историей покупок сформированы персональные рекомендации:

| Поле | Описание |
|------|----------|
| `company_id` | ID клиента |
| `rank` | Позиция в рейтинге (1, 2, 3) |
| `offer_product` | Рекомендуемый продукт |
| `prob` | Вероятность покупки |
| `expected_revenue` | Ожидаемая выручка |

Пример:
| company_id | rank | offer_product | prob | expected_revenue |
|------------|------|---------------|------|------------------|
| comp_001eac7794df | 1 | Тарифы Webinar СМБ | 0.98 | 11,322 ₽ |
| comp_001eac7794df | 2 | Расширения | 0.01 | 150 ₽ |
| comp_003be29c3721 | 1 | МТС Линк. Корпорация | 0.64 | 16,656 ₽ |


## Ключевые выводы

1. **Модель работает хорошо** — Top-3 Accuracy 90.7% означает, что в 9 из 10 случаев верный продукт попадает в топ-3 рекомендаций.

2. **Главный предиктор — предыдущий продукт.** Клиенты склонны покупать те же или смежные продукты.

3. **Сильный дисбаланс:** 77% покупок — это "Расширения" и "Тарифы Webinar СМБ". Модель это учитывает.

4. **High-value клиенты предсказуемее** — для них Top-3 Accuracy достигает 94%.

5. **Coverage 73%** — модель рекомендует 19 из 26 продуктов. Редкие Enterprise-тарифы не попадают в рекомендации из-за малого количества данных.

6. **440 компаний без рекомендаций** — для них недостаточно истории покупок (только одна транзакция). При появлении повторных покупок модель сможет генерировать рекомендации.


## Рекомендации по внедрению

1. **Провести A/B тест** — измерить реальный lift в конверсии и выручке.

2. **Интегрировать в CRM** — показывать менеджерам топ-3 оффера при работе с клиентом.

3. **Добавить бизнес-правила:**
   - Не предлагать продукт, который клиент уже купил
   - Учитывать сезонность и акции
   - Ограничить частоту контактов

4. **Мониторинг качества** — отслеживать метрики и переобучать модель при деградации.


## Файлы

- `CDA/nbo.ipynb` — ноутбук с моделью и анализом
- `CDA/nbo_recs.csv` — файл с рекомендациями для всех клиентов

