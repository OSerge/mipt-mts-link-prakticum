# Отчет: Прогнозирование LTV на 12 месяцев

## Цель проекта

Построить модель прогнозирования Lifetime Value (LTV) клиентов на горизонте 12 месяцев для приоритизации работы с клиентской базой.

## Методология

### Данные
- Источник: транзакционные данные о продажах
- Период обучения: до октября 2022 года
- Holdout: октябрь 2022 — октябрь 2023 (12 месяцев)
- Объем: ~2,000 клиентов, ~16,800 транзакций

### Подходы к моделированию

Протестировано 5 подходов:

1. **Baseline** — простое правило: LTV_next12m = LTV_last12m
2. **ElasticNet (6 признаков)** — линейная регрессия с базовыми RFM-признаками
3. **ElasticNet (15 признаков)** — линейная регрессия с расширенным набором признаков
4. **LightGBM (15 признаков)** — градиентный бустинг
5. **BG/NBD + Gamma-Gamma** — вероятностная модель частоты покупок и среднего чека

### Feature Engineering

Построено 15 признаков:
- **RFM-базовые**: recency, frequency, monetary, mean_cheque, customer_age_days
- **Временные (12м)**: freq_12m, monetary_12m, orders_12m, growth_rate_12m
- **Продуктовые**: n_unique_products, renewal_share_line, has_collab
- **Чековые**: median_check, check_cv, last_check_ratio

## Результаты

### Сравнение моделей

| Модель | MAE | RMSE | R² | Улучшение MAE vs baseline |
|--------|-----|------|----|---------------------------|
| Baseline | 17,505 | 37,531 | 0.07 | — |
| ElasticNet (6 фич) | 23,200 | 43,689 | <0 | -32.5% |
| ElasticNet (15 фич) | 23,000 | 43,689 | <0 | -31.4% |
| **LightGBM** | **17,096** | **34,664** | **0.21** | **+2.3%** |
| BG/NBD + GG | 18,643 | 32,082 | 0.32 | -6.5% |

### Ключевые выводы

1. **LightGBM показал лучший результат:**
   - MAE снижен на 2.3% относительно baseline (17,505 → 17,096)
   - R² = 0.21 (объясняет 21% дисперсии) против 0.07 у baseline
   - Модель улавливает нелинейные взаимодействия признаков

2. **Линейные модели неэффективны:**
   - ElasticNet показывает MAE на 31-32% хуже baseline
   - Расширение признаков не улучшает результат
   - Данные имеют сильную нелинейную структуру

3. **Важнейшие признаки (LightGBM):**
   - `monetary_12m` — выручка за последние 12 месяцев (основной предиктор)
   - `monetary` — общая историческая выручка
   - `growth_rate_12m` — темп роста клиента

4. **BG/NBD показал лучший R² (0.32), но хуже по MAE:**
   - Вероятностная модель хорошо объясняет дисперсию
   - Но уступает по точности прогноза конкретных сумм
   - Может использоваться как дополнительный сигнал для сегментации

## Рекомендации

### Для production
- Использовать модель **LightGBM** с расширенным набором признаков (15 фич)
- Приоритизировать клиентов по категориям: VIP / High / Medium / Low (на основе перцентилей LTV)
- Внедрить мониторинг качества прогнозов и переобучения
- Обновлять модель ежемесячно с учетом новых транзакций

### Практическое применение

**Выгружены списки для работы:**
- `top100_clients_ltv.csv` — топ-100 клиентов по прогнозному LTV
- `priority_segments.csv` — клиенты с рекомендациями по работе

**Сформировано 4 бизнес-сегмента:**

1. **VIP_Growth** (приоритет: retention + upsell)
   - Клиенты с высоким LTV и ростом >20%
   - Действие: удержание и продажа коллаборативных продуктов

2. **VIP_AtRisk** (приоритет: предотвращение оттока)
   - VIP-клиенты с падением выручки (рост <80%)
   - Действие: отдел клиентского сервиса, спецпредложения

3. **High_CrossSell** (приоритет: кросс-сейл)
   - Высокий потенциал LTV, но мало продуктов (≤2)
   - Действие: предложить дополнительные продукты

4. **Medium_Renewal** (приоритет: повторные покупки)
   - Средний сегмент с низкой долей продлений (<30%)
   - Действие: стимулировать продления

### Дальнейшее развитие
1. **Улучшение модели:**
   - Добавить внешние данные (отрасль, размер компании, география)
   - Тестировать CatBoost с Tweedie-лоссом для работы с нулевыми значениями
   - Двухступенчатый подход: классификация (купит/не купит) + регрессия на величину LTV

2. **Мониторинг и A/B-тесты:**
   - Отслеживать конверсию по сегментам (VIP_Growth, VIP_AtRisk, etc.)
   - Тестировать эффективность разных стратегий работы с клиентами
   - Измерять uplift от персонализированных предложений vs стандартных

3. **Интеграция:**
   - Автоматическая выгрузка приоритетных списков в CRM
   - Дашборд для отслеживания топ-клиентов в реальном времени
   - Алерты на клиентов с риском оттока (VIP_AtRisk)

## Метрики эффективности внедрения

Топ-10% клиентов по прогнозу покрывают значительную долю ожидаемой выручки. 
Концентрация усилий на этих клиентах позволит максимизировать ROI продаж и отдела клиентского сервиса.

## Заключение

Модель LightGBM успешно прогнозирует LTV на 12 месяцев с ошибкой MAE около `17,100` рублей (улучшение на `2.3%` vs baseline). 

**Практические результаты:**
- Сформировано 4 бизнес-сегмента с конкретными стратегиями работы
- Выгружены приоритетные списки клиентов (топ-100 и сегменты)
- Модель готова к использованию для приоритизации клиентов и планирования продаж

**Следующие шаги:**
1. Передать списки в отдел продаж/CS для работы
2. Настроить мониторинг конверсии по сегментам
3. Запустить A/B-тесты разных стратегий
4. Обновить модель через месяц с учетом новых данных

